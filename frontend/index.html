<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>College Billing Portal</title>
    <meta name="description" content="College billing portal for fee receipts and balances." />
    <style>
      #rootFallback {
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
        padding: 24px;
        color: #0f172a;
      }
      #rootFallback h1 {
        margin: 0 0 8px;
        font-size: 20px;
      }
      #rootFallback p {
        margin: 0;
        color: #475569;
      }
    </style>
    <script>
      (function () {
        // Capture early resource load failures for module scripts/styles (these don't always trigger window.onerror).
        try {
          document.addEventListener(
            "load",
            (e) => {
              const t = e && e.target;
              if (!t || !t.tagName) return;
              if (t.tagName === "SCRIPT" && t.getAttribute && t.getAttribute("type") === "module") {
                window.__BILLING_MODULE_SCRIPT_LOADED__ = t.getAttribute("src") || t.src || true;
              }
              if (t.tagName === "LINK" && t.getAttribute && t.getAttribute("rel") === "stylesheet") {
                window.__BILLING_STYLESHEET_LOADED__ = t.getAttribute("href") || t.href || true;
              }
            },
            true
          );
          document.addEventListener(
            "error",
            (e) => {
              const t = e && e.target;
              if (!t || !t.tagName) return;
              if (t.tagName === "SCRIPT") {
                window.__BILLING_MODULE_SCRIPT_ERROR__ = t.getAttribute("src") || t.src || true;
              }
              if (t.tagName === "LINK") {
                window.__BILLING_STYLESHEET_ERROR__ = t.getAttribute("href") || t.href || true;
              }
            },
            true
          );
        } catch {
          // ignore
        }

        const escapeHtml = (s) =>
          String(s || "")
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/"/g, "&quot;")
            .replace(/'/g, "&#039;");

        const tryFetchText = async (url) => {
          try {
            const res = await fetch(url, { cache: "no-store" });
            const ct = res.headers.get("content-type") || "";
            const isText = ct.includes("text") || ct.includes("javascript") || ct.includes("json");
            const body = isText ? await res.text() : "";
            return {
              ok: res.ok,
              status: res.status,
              contentType: ct,
              snippet: body ? body.slice(0, 180) : ""
            };
          } catch (err) {
            return {
              ok: false,
              status: 0,
              contentType: "",
              snippet: String(err && err.message ? err.message : err)
            };
          }
        };

        const show = (msg, details) => {
          const el = document.getElementById("rootFallback");
          if (!el) return;
          el.innerHTML =
            "<h1>App failed to load</h1><p>" +
            escapeHtml(msg || "Please refresh (Ctrl+F5).") +
            "</p>" +
            (details
              ? '<pre style="white-space:pre-wrap;opacity:.85;margin-top:10px">' + escapeHtml(details) + "</pre>"
              : "");
        };

        window.addEventListener("error", (e) => {
          const details =
            e && e.error && (e.error.stack || e.error.message)
              ? e.error.stack || e.error.message
              : e && e.message
                ? e.message
                : "";
          show("A JavaScript error stopped the app. Try Incognito mode / disable extensions, then refresh (Ctrl+F5).", details);
        });

        window.addEventListener("unhandledrejection", (e) => {
          const reason = e && e.reason ? e.reason.stack || e.reason.message || String(e.reason) : "";
          show("A background error stopped the app. Refresh (Ctrl+F5). If it still fails, try Incognito mode.", reason);
        });

        window.addEventListener("DOMContentLoaded", () => {
          const moduleScript = document.querySelector('script[type="module"][src]');
          if (!moduleScript) return;
          moduleScript.addEventListener("error", () => {
            show("Failed to load the app JavaScript. Refresh (Ctrl+F5).", `Script failed to load: ${moduleScript.getAttribute("src")}`);
          });
        });

        setTimeout(() => {
          const el = document.getElementById("rootFallback");
          if (!el) return;

          (async () => {
            const lines = [];

            const moduleScript = document.querySelector('script[type="module"][src]');
            lines.push(`Boot started: ${String(Boolean(window.__BILLING_BOOT_STARTED__))}`);
            lines.push(`Boot rendered: ${String(Boolean(window.__BILLING_BOOT_RENDERED__))}`);
            lines.push(`Module onload: ${String(window.__BILLING_MODULE_SCRIPT_LOADED__ || "")}`);
            lines.push(`Module onerror: ${String(window.__BILLING_MODULE_SCRIPT_ERROR__ || "")}`);
            lines.push(`CSS onload: ${String(window.__BILLING_STYLESHEET_LOADED__ || "")}`);
            lines.push(`CSS onerror: ${String(window.__BILLING_STYLESHEET_ERROR__ || "")}`);
            if (window.__BILLING_BOOT_ERROR__) {
              lines.push("");
              lines.push("Boot error:");
              lines.push(String(window.__BILLING_BOOT_ERROR__).slice(0, 1200));
            }
            lines.push("");

            if (moduleScript && moduleScript.getAttribute("src")) {
              const src = moduleScript.getAttribute("src");
              const r = await tryFetchText(src);
              lines.push(`Module script: ${src}`);
              lines.push(`  status: ${r.status || "ERR"}`);
              if (r.contentType) lines.push(`  content-type: ${r.contentType}`);
              if (r.snippet) lines.push(`  snippet: ${r.snippet.replace(/\\s+/g, " ").trim()}`);
            } else {
              lines.push("Module script tag not found.");
            }

            const css = document.querySelector('link[rel="stylesheet"][href]');
            if (css && css.getAttribute("href")) {
              const href = css.getAttribute("href");
              const r = await tryFetchText(href);
              lines.push("");
              lines.push(`CSS: ${href}`);
              lines.push(`  status: ${r.status || "ERR"}`);
              if (r.contentType) lines.push(`  content-type: ${r.contentType}`);
            }

            show(
              "Still loading. Hard refresh (Ctrl+F5). If it still fails, open Incognito mode / disable extensions.",
              lines.join("\n")
            );
          })();
        }, 8000);
      })();
    </script>
  </head>
  <body>
    <div id="root">
      <div id="rootFallback">
        <h1>Loading...</h1>
        <p>If this stays blank, refresh the page (Ctrl+F5).</p>
      </div>
    </div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
